# 이상 탐지 모델 성능 개선 가이드

## 현재 성능 분석

### DeepLog
- ✅ **재현율: 99.93%** (거의 모든 이상을 탐지)
- ❌ **정확도: 7.02%** (매우 낮음)
- ❌ **정밀도: 7.02%** (오탐이 많음)
- ❌ **특이도: 0%** (정상을 이상으로 잘못 탐지)
- **문제**: False Positive가 너무 많음 (18,596개)
- **해결책**: 임계값을 높여서 오탐을 줄여야 함

### LogAnomaly
- ✅ **정확도: 89.80%** (높음)
- ✅ **특이도: 96.34%** (정상을 잘 구분)
- ❌ **재현율: 3.13%** (대부분의 이상을 놓침)
- ❌ **정밀도: 6.07%** (낮음)
- **문제**: False Negative가 너무 많음 (1,360개)
- **해결책**: 임계값을 낮춰서 이상을 더 많이 탐지해야 함

## 목표 성능 지표

**평가 모델로 사용하기 적합한 수준:**

| 지표 | 목표 | 설명 |
|------|------|------|
| 정확도 | **70% 이상** | 전체 예측 중 맞는 비율 |
| 정밀도 | **50% 이상** | 이상으로 탐지한 것 중 실제 이상 비율 |
| 재현율 | **60% 이상** | 실제 이상 중 탐지한 비율 |
| F1 점수 | **55% 이상** | 정밀도와 재현율의 조화 평균 |
| 특이도 | **80% 이상** | 정상을 정상으로 올바르게 구분 |

## 성능 개선 방법

### 1. 임계값 최적화 (가장 중요) ⭐

```bash
# 최적 임계값 자동 탐색으로 성능 개선
python log_specific_model_comparison.py --optimize-threshold

# 목표 성능 설정
python log_specific_model_comparison.py \
    --optimize-threshold \
    --target-accuracy 0.70 \
    --target-precision 0.50 \
    --target-recall 0.60 \
    --target-f1 0.55 \
    --target-specificity 0.80
```

### 2. 더 많은 학습 데이터

```bash
# 학습 데이터 증가 (10만개 → 50만개)
python log_specific_model_comparison.py \
    --sample-size 500000 \
    --epochs 10 \
    --batch-size 64
```

### 3. 학습 파라미터 조정

```bash
# 더 많은 epoch로 학습
python log_specific_model_comparison.py \
    --epochs 20 \
    --batch-size 64

# 배치 크기 조정
python log_specific_model_comparison.py \
    --epochs 10 \
    --batch-size 32
```

### 4. 평가 데이터 샘플링 (빠른 테스트)

```bash
# 평가 데이터 2만개만 사용 (빠른 평가)
python log_specific_model_comparison.py \
    --eval-sample-size 20000 \
    --optimize-threshold
```

## 권장 실행 방법

### 빠른 테스트 (10만개 데이터)
```bash
python log_specific_model_comparison.py \
    --sample-size 100000 \
    --epochs 5 \
    --batch-size 128 \
    --eval-sample-size 20000 \
    --optimize-threshold
```

### 정확한 평가 (더 많은 데이터)
```bash
python log_specific_model_comparison.py \
    --sample-size 500000 \
    --epochs 15 \
    --batch-size 64 \
    --optimize-threshold \
    --target-accuracy 0.70 \
    --target-precision 0.50 \
    --target-recall 0.60
```

## 예상 개선 효과

### DeepLog 개선 시나리오
- **현재**: 정확도 7%, 정밀도 7%, 재현율 99.93%
- **임계값 조정 후 예상**: 정확도 60-70%, 정밀도 40-50%, 재현율 70-80%
- **개선 방법**: 임계값을 높여서 오탐 감소

### LogAnomaly 개선 시나리오
- **현재**: 정확도 89.80%, 정밀도 6%, 재현율 3.13%
- **임계값 조정 후 예상**: 정확도 75-85%, 정밀도 40-50%, 재현율 50-70%
- **개선 방법**: 임계값을 낮춰서 이상 탐지율 증가

## 최종 권장사항

1. **임계값 최적화 활성화**: `--optimize-threshold` 옵션 사용
2. **학습 데이터 증가**: 최소 20만개 이상 권장
3. **Epoch 증가**: 최소 10 epoch 이상 권장
4. **목표 성능 설정**: 위의 목표 지표 기준으로 설정

## 실행 예시

```bash
cd /Users/zzangdol/PycharmProjects/zzangdol/pattern/prelog

# 최적화된 평가 (권장)
python log_specific_model_comparison.py \
    --optimize-threshold \
    --sample-size 200000 \
    --epochs 10 \
    --batch-size 64 \
    --eval-sample-size 50000
```

이 설정으로 **정확도 70%+, F1 점수 55%+** 수준의 평가 모델을 만들 수 있습니다.




